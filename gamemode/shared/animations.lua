local Anims = {}
Anims[ACT_GMOD_GESTURE_BOW] = "Bow"
Anims[ACT_GMOD_TAUNT_MUSCLE] = "Dance"
Anims[ACT_GMOD_GESTURE_BECON] = "Follow me!"
Anims[ACT_GMOD_TAUNT_LAUGH] = "Laugh"
Anims[ACT_GMOD_TAUNT_PERSISTENCE] = "Lion Pose"
Anims[ACT_GMOD_GESTURE_DISAGREE] = "Non-verbal no"
Anims[ACT_GMOD_GESTURE_AGREE] = "Thumbs up"
Anims[ACT_GMOD_GESTURE_WAVE] = "Wave"

local SciencePhrases = {}
SciencePhrases["Hello"] = "/scientist/hello.wav"
SciencePhrases["Simulation"] = "/scientist/simulation.wav"
SciencePhrases["Grant Money"] = "/scientist/nogrant.wav"
SciencePhrases["Clear Throat"] = "/scientist/c1a0_sci_stall.wav" -- new
SciencePhrases["Sneeze"] = "/scientist/sneeze.wav" -- new
SciencePhrases["Stop!"] = "/scientist/sci_pain9.wav" -- new
SciencePhrases["I\'ll stay here"] = "/scientist/istay.wav" -- new
SciencePhrases["Cough"] = "/scientist/cough.wav"
SciencePhrases["Coffee Cup"] = "/scientist/seencup.wav"
SciencePhrases["Lambda Lab"] = "/scientist/lambdalab.wav"
SciencePhrases["Glasses"] = "/scientist/hideglasses.wav"
SciencePhrases["Beverage Machine"] = "/scientist/beverage.wav"
SciencePhrases["Are you thinking?"] = "/scientist/areyouthink.wav"
SciencePhrases["Ties"] = "/scientist/weartie.wav"
SciencePhrases["What you doing?"] = "/scientist/whatyoudoing.wav"
SciencePhrases["Yes"] = "/scientist/yes3.wav"
SciencePhrases["Yeees"] = "/scientist/yees.wav"
SciencePhrases["Theoretical Limits"] = "/scientist/limitsok.wav"
SciencePhrases["Greetings"] = "/scientist/greetings.wav"
SciencePhrases["Let\'s Go"] = "/scientist/letsgo.wav"
SciencePhrases["Thats odd"] = "/scientist/thatsodd.wav"
SciencePhrases["Shutdown Chart"] = "/scientist/shutdownchart.wav"
SciencePhrases["Run test again"] = "/scientist/runtest.wav"
SciencePhrases["Scream"] = "/scientist/scream07.wav"
SciencePhrases["Test Chamber 30"] = "/scientist/sci_somewhere.wav"
SciencePhrases["Noo"] = "/scientist/noo.wav"
SciencePhrases["Noo - Scared"] = "/scientist/nooo.wav"
SciencePhrases["Report Fluxuation"] = "/scientist/reportflux.wav"
SciencePhrases["Perhaps"] = "/scientist/perhaps.wav"
SciencePhrases["New HEV Suit"] = "/scientist/newhevsuit.wav"
SciencePhrases["Fascinating"] = "/scientist/neverseen.wav"
SciencePhrases["Blood Sample"] = "/scientist/bloodsample.wav"

local SecurityPhrases = {}
SecurityPhrases["Hello sir"] = "/barney/howyoudoing.wav"
SecurityPhrases["Guarding"] = "/barney/standguard.wav"
SecurityPhrases["Bad feeling"] = "/barney/badfeeling.wav"
SecurityPhrases["Go on through"] = "/barney/c1a0_ba_hevyes.wav"
SecurityPhrases["Dont ask me"] = "/barney/dontaskme.wav"
SecurityPhrases["No sir"] = "/barney/nosir.wav"
SecurityPhrases["Target practice"] = "/barney/targetpractice.wav"
SecurityPhrases["Yes sir"] = "/barney/yessir.wav"
SecurityPhrases["Big mess"] = "/barney/bigmess.wav"
SecurityPhrases["Yup"] = "/barney/yup.wav"
SecurityPhrases["You hear that"] = "/barney/youhearthat.wav"
SecurityPhrases["You got it"] = "/barney/yougotit.wav"
SecurityPhrases["You ever seen"] = "/barney/youeverseen.wav"
SecurityPhrases["You bet"] = "/barney/youbet.wav"
SecurityPhrases["Working on stuff"] = "/barney/workingonstuff.wav"
SecurityPhrases["Whats going on?"] = "/barney/whatsgoingon.wav"
SecurityPhrases["What is that?"] = "/barney/whatisthat.wav"
SecurityPhrases["Not waiting around"] = "/barney/c1a2_ba_top.wav" -- new
SecurityPhrases["Talk too much"] = "/barney/youtalkmuch.wav" -- new
SecurityPhrases["Can\'t take much more"] = "/barney/imdead.wav" -- new
SecurityPhrases["Not scared are ya?"] = "/barney/aintscared.wav" -- new
SecurityPhrases["What good"] = "/barney/whatgood.wav"
SecurityPhrases["Way out"] = "/barney/wayout.wav"
SecurityPhrases["I\'m waiting"] = "/barney/waitin.wav"
SecurityPhrases["Thinking"] = "/barney/thinking.wav"
SecurityPhrases["I\'ll cover you"] = "/barney/teamup2.wav"
SecurityPhrases["Survive this"] = "/barney/survive.wav"
SecurityPhrases["Not go further"] = "/barney/stophere.wav"

local HECUPhrases = {}
HECUPhrases["Hello sir"] = "/opforce_grunt/hello_sir.wav"
HECUPhrases["Yes sir"] = "/opforce_grunt/yes_sir.wav"
HECUPhrases["Grenade!"] = "/opforce_grunt/grenade.wav"
HECUPhrases["Let\'s Go"] = "/opforce_grunt/lets_go.wav"
HECUPhrases["Negative Sir"] = "/opforce_grunt/negative_sir.wav"
HECUPhrases["Was told to guard"] = "/opforce_grunt/to_guard.wav"
HECUPhrases["At your command"] = "/opforce_grunt/your_command.wav"
HECUPhrases["Take cover!"] = "/opforce_grunt/take_cover.wav"
HECUPhrases["Medic!"] = "/opforce_grunt/medic.wav"
HECUPhrases["Get down!"] = "/opforce_grunt/get_down.wav"
HECUPhrases["Need backup!"] = "/opforce_grunt/need_backup.wav"
HECUPhrases["Okay, check in"] = "/opforce_grunt/check_in.wav"
HECUPhrases["Clear Area"] = "/opforce_grunt/clear_area.wav"
HECUPhrases["Got Hostiles"] = "/opforce_grunt/got_hostiles.wav"
HECUPhrases["Fire in the hole!"] = "/opforce_grunt/fire_inhole.wav"
HECUPhrases["Gov cover ups"] = "/opforce_grunt/cover_ups.wav"
HECUPhrases["Kick Ass!"] = "/opforce_grunt/kick_ass.wav"
HECUPhrases["Friendly Fire!"] = "/opforce_grunt/friendly_fire.wav"
HECUPhrases["Disney Land"] = "/opforce_grunt/disney_land.wav"
HECUPhrases["Current situation"] = "/opforce_grunt/current.wav"
HECUPhrases["Covering Fire!"] = "/opforce_grunt/covering.wav"
HECUPhrases["Bad Feeling"] = "/opforce_grunt/bad_feeling.wav"
HECUPhrases["More Damage"] = "/opforce_grunt/more_damage.wav"
HECUPhrases["Move in!"] = "/opforce_grunt/move_in.wav"
HECUPhrases["Baby sitting"] = "/opforce_grunt/baby_sitting.wav"
HECUPhrases["Area Secure"] = "/opforce_grunt/area_secure.wav"
HECUPhrases["Flash Wound"] = "/opforce_grunt/flash_wound.wav"

hook.Add("CalcMainActivity", "darkrp_animations", function(ply, velocity) -- Using hook.Add and not GM:CalcMainActivity to prevent animation problems
	-- Dropping weapons/money!
	if ply.anim_DroppingItem then
		ply:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_GMOD_GESTURE_ITEM_DROP, true)
		ply.anim_DroppingItem = nil
	end

	-- Giving items!
	if ply.anim_GivingItem then
		ply:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_GMOD_GESTURE_ITEM_GIVE, true)
		ply.anim_GivingItem = nil
	end

	if CLIENT and ply.SaidHi then
		ply:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_SIGNAL_GROUP, true)
		ply.SaidHi = nil
	end

	if CLIENT and ply.ThrewPoop then
		ply:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_GMOD_GESTURE_ITEM_THROW, true)
		ply.ThrewPoop = nil
	end

	if CLIENT and ply.knocking then
		ply:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_HL2MP_GESTURE_RANGE_ATTACK_FIST, true)
		ply.knocking = nil
	end

	if CLIENT and ply.usekeys then
		ply:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_GMOD_GESTURE_ITEM_PLACE, true)
		ply.usekeys = nil
	end

	if not SERVER then return end

	-- Hobo throwing poop!
	local Weapon = ply:GetActiveWeapon()
	if RPExtraTeams[ply:Team()] and RPExtraTeams[ply:Team()].hobo and not ply.ThrewPoop and IsValid(Weapon) and Weapon:GetClass() == "weapon_bugbait" and ply:KeyDown(IN_ATTACK) then
		ply.ThrewPoop = true
		ply:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_GMOD_GESTURE_ITEM_THROW, true)


		local RP = RecipientFilter()
		RP:AddAllPlayers()

		umsg.Start("anim_throwpoop", RP)
			umsg.Entity(ply)
		umsg.End()
	elseif ply.ThrewPoop and not ply:KeyDown(IN_ATTACK) then
		ply.ThrewPoop = nil
	end

	-- Saying hi/hello to a player
	if not ply.SaidHi and IsValid(Weapon) and Weapon:GetClass() == "weapon_physgun" and ply:KeyDown(IN_ATTACK) then
		local ent = ply:GetEyeTrace().Entity
		if IsValid(ent) and ent:IsPlayer() then
			ply.SaidHi = true
			ply:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_SIGNAL_GROUP, true)

			local RP = RecipientFilter()
			RP:AddAllPlayers()

			umsg.Start("anim_sayhi", RP)
				umsg.Entity(ply)
			umsg.End()
		end
	elseif ply.SaidHi and not ply:KeyDown(IN_ATTACK) then
		ply.SaidHi = nil
	end
end)

if SERVER then
	local function CustomAnim(ply, cmd, args)
		local Gesture = tonumber(args[1] or 0)
		if not Anims[Gesture] then return end

		local RP = RecipientFilter()
		RP:AddAllPlayers()

		umsg.Start("_DarkRP_CustomAnim", RP)
		umsg.Entity(ply)
		umsg.Short(Gesture)
		umsg.End()
	end
	concommand.Add("_DarkRP_DoAnimation", CustomAnim)
	
	local function DoSciencePhrase(ply, cmd, args)
 
		local SciencePhrase = (args[1] or 0)
		--if not SciencePhrases[SciencePhrase] then return end
		local RP = RecipientFilter()
		RP:AddAllPlayers()
		
		if not table.HasValue(SciencePhrases, SciencePhrase) then 
			return
		end
		
		if ply:Team() == TEAM_PHYSICIST or ply:Team() == TEAM_BIOWORKER or ply:Team() == TEAM_HEADPHYSICIST or ply:Team() == TEAM_BIOLOGIST or ply:Team() == TEAM_HES or ply:Team() == TEAM_SCIINSTRUCTOR or ply:Team() == TEAM_EXPLORATION or ply:Team() == TEAM_HEADEXPLORATION then
			ply:EmitSound(Sound(SciencePhrase),80, 100)
		end	
	end
	concommand.Add("BMRP_DoSciencePhrase", DoSciencePhrase)
	
	local function DoSecurityPhrase(ply, cmd, args)
 
		local SecurityPhrase = (args[1] or 0)
		--if not SciencePhrases[SciencePhrase] then return end
		local RP = RecipientFilter()
		RP:AddAllPlayers()
		
		if not table.HasValue(SecurityPhrases, SecurityPhrase) then 
			return
		end
		
		if ply:Team() == TEAM_SECURITY or ply:Team() == TEAM_SECINSTRUCTOR or ply:Team() == TEAM_SECURITYADMIN then
			ply:EmitSound(Sound(SecurityPhrase),80, 100)
		end	
	end
	concommand.Add("BMRP_DoSecurityPhrase", DoSecurityPhrase)
	
	local function DoHECUPhrase(ply, cmd, args)
 
		local HECUPhrase = (args[1] or 0)

		local RP = RecipientFilter()
		RP:AddAllPlayers()
		
		if not table.HasValue(HECUPhrases, HECUPhrase) then 
			return
		end
		
		if ply:Team() == TEAM_HECU or ply:Team() == TEAM_HECUCOMMANDER then
			ply:EmitSound(Sound(HECUPhrase),80, 100)
		end	
	end
	concommand.Add("BMRP_DoHECUPhrase", DoHECUPhrase)
	
	return
end

local function DropItem(um)
	local ply = um:ReadEntity()
	if not IsValid(ply) then return end

	ply.anim_DroppingItem = true
end
usermessage.Hook("anim_dropitem", DropItem)

local function GiveItem(um)
	local ply = um:ReadEntity()
	if not IsValid(ply) then return end

	ply.anim_GivingItem = true
end
usermessage.Hook("anim_giveitem", GiveItem)

local function ThrowPoop(um)
	local ply = um:ReadEntity()
	if not IsValid(ply) then return end

	ply.ThrewPoop = true
end
usermessage.Hook("anim_throwpoop", ThrowPoop)

local function PhysgunHi(um)
	local ply = um:ReadEntity()
	if not IsValid(ply) then return end

	ply.SaidHi = true
end
usermessage.Hook("anim_sayhi", PhysgunHi)

local function KeysAnims(um)
	local ply = um:ReadEntity()
	if not IsValid(ply) then return end
	local Type = um:ReadString()
	ply[Type] = true
end
usermessage.Hook("anim_keys", KeysAnims)


local function CustomAnimation(um)
	local ply = um:ReadEntity()
	local act = um:ReadShort()

	if not IsValid(ply) then return end
	ply:AnimRestartGesture(GESTURE_SLOT_CUSTOM, act, true)
end
usermessage.Hook("_DarkRP_CustomAnim", CustomAnimation)

local AnimFrame
local function AnimationMenu()
	if AnimFrame then return end

	local Panel = vgui.Create("Panel")
	Panel:SetPos(0,0)
	Panel:SetSize(ScrW(), ScrH())
	function Panel:OnMousePressed()
		AnimFrame:Close()
	end

	AnimFrame = AnimFrame or vgui.Create("DFrame", Panel)
	local Height = table.Count(Anims) * 60
	AnimFrame:SetSize(130, Height)
	AnimFrame:SetPos(ScrW()/2 + ScrW() * 0.1, ScrH()/2 - (Height/2))
	AnimFrame:SetTitle("Act")
	AnimFrame:SetVisible(true)
	AnimFrame:MakePopup()

	function AnimFrame:Close()
		Panel:Remove()
		AnimFrame:Remove()
		AnimFrame = nil
	end

	local i = 0
	for k,v in SortedPairs(Anims) do
		i = i + 1
		local button = vgui.Create("DButton", AnimFrame)
		button:SetPos(10, (i-1)*55 + 30)
		button:SetSize(110, 50)
		button:SetText(v)

		button.DoClick = function()
			RunConsoleCommand("_DarkRP_DoAnimation", k)
		end
	end
	AnimFrame:SetSkin(GAMEMODE.Config.DarkRPSkin)
end
concommand.Add("_DarkRP_AnimationMenu", AnimationMenu)



/*
===============
Science Phrases
===============
*/

local ScienceFrame
local function ScienceMenu()
	StopSpam = 0
	if ScienceFrame then return end

	local SciencePanel = vgui.Create("Panel")
	SciencePanel:SetPos(0,0)
	SciencePanel:SetSize(ScrW(), ScrH())
	function SciencePanel:OnMousePressed()
		ScienceFrame:Close()
	end

	ScienceFrame = ScienceFrame or vgui.Create("DFrame", SciencePanel)
	local Height = table.Count(SciencePhrases) * 21.5
	ScienceFrame:SetSize(150, Height)
	ScienceFrame:SetPos(ScrW()/2 + ScrW() * 0.1, ScrH()/2 - (Height/2))
	ScienceFrame:SetTitle("Voice")
	ScienceFrame:SetVisible(true)
	ScienceFrame:MakePopup()

	function ScienceFrame:Close()
		SciencePanel:Remove()
		ScienceFrame:Remove()
		ScienceFrame = nil
	end

	local Sciencei = 0
	local StopSpam = 0
	for k,v in SortedPairs(SciencePhrases) do
		Sciencei = Sciencei + 1
		local SciencePhraseButton = vgui.Create("DButton", ScienceFrame)
		SciencePhraseButton:SetPos(20, (Sciencei-1)*20 + 30)
		SciencePhraseButton:SetSize(110, 20)
		SciencePhraseButton:SetText(k)

		SciencePhraseButton.DoClick = function()
		if StopSpam == 0 then
		RunConsoleCommand("BMRP_DoSciencePhrase", v)
		StopSpam = 1
		end
		
		timer.Create( "VoiceSpam", 2, 1, function()
		StopSpam = 0
			--ply:EmitSound(Sound(v),80, 100)
			end)
		end
	end
	ScienceFrame:SetSkin("DarkRP")
end
concommand.Add("SciencePhrases", ScienceMenu)

/*
================
Security Phrases
================
*/

local SecurityFrame
local function SecurityMenu()
	StopSpam = 0
	if SecurityFrame then return end

	local SecurityPanel = vgui.Create("Panel")
	SecurityPanel:SetPos(0,0)
	SecurityPanel:SetSize(ScrW(), ScrH())
	function SecurityPanel:OnMousePressed()
		SecurityFrame:Close()
	end

	SecurityFrame = SecurityFrame or vgui.Create("DFrame", SecurityPanel)
	local Height2 = table.Count(SecurityPhrases) * 21.5
	SecurityFrame:SetSize(150, Height2)
	SecurityFrame:SetPos(ScrW()/2 + ScrW() * 0.1, ScrH()/2 - (Height2/2))
	SecurityFrame:SetTitle("Voice")
	SecurityFrame:SetVisible(true)
	SecurityFrame:MakePopup()

	function SecurityFrame:Close()
		SecurityPanel:Remove()
		SecurityFrame:Remove()
		SecurityFrame = nil
	end

	local Securityi = 0
	local StopSpam = 0
	for k,v in SortedPairs(SecurityPhrases) do
		Securityi = Securityi + 1
		local SecurityPhraseButton = vgui.Create("DButton", SecurityFrame)
		SecurityPhraseButton:SetPos(20, (Securityi-1)*20 + 30)
		SecurityPhraseButton:SetSize(110, 20)
		SecurityPhraseButton:SetText(k)

		SecurityPhraseButton.DoClick = function()
		if StopSpam == 0 then
		RunConsoleCommand("BMRP_DoSecurityPhrase", v)
		StopSpam = 1
		end
		
		timer.Create( "VoiceSpam", 2, 1, function()
		StopSpam = 0
			--ply:EmitSound(Sound(v),80, 100)
			end)
		end
	end
	SecurityFrame:SetSkin("DarkRP")
end
concommand.Add("SecurityPhrases", SecurityMenu)

/*
================
HECU Phrases
================
*/

local HECUFrame
local function HECUMenu()
	StopSpam = 0
	if HECUFrame then return end

	local HECUPanel = vgui.Create("Panel")
	HECUPanel:SetPos(0,0)
	HECUPanel:SetSize(ScrW(), ScrH())
	function HECUPanel:OnMousePressed()
		HECUFrame:Close()
	end

	HECUFrame = HECUFrame or vgui.Create("DFrame", HECUPanel)
	local Height2 = table.Count(HECUPhrases) * 21.5
	HECUFrame:SetSize(150, Height2)
	HECUFrame:SetPos(ScrW()/2 + ScrW() * 0.1, ScrH()/2 - (Height2/2))
	HECUFrame:SetTitle("Voice")
	HECUFrame:SetVisible(true)
	HECUFrame:MakePopup()

	function HECUFrame:Close()
		HECUPanel:Remove()
		HECUFrame:Remove()
		HECUFrame = nil
	end

	local HECUi = 0
	local StopSpam = 0
	for k,v in SortedPairs(HECUPhrases) do
		HECUi = HECUi + 1
		local HECUPhraseButton = vgui.Create("DButton", HECUFrame)
		HECUPhraseButton:SetPos(20, (HECUi-1)*20 + 30)
		HECUPhraseButton:SetSize(110, 20)
		HECUPhraseButton:SetText(k)

		HECUPhraseButton.DoClick = function()
		if StopSpam == 0 then
		RunConsoleCommand("BMRP_DoHECUPhrase", v)
		StopSpam = 1
		end
		
		timer.Create( "VoiceSpam", 2, 1, function()
		StopSpam = 0

			end)
		end
	end
	HECUFrame:SetSkin("DarkRP")
end
concommand.Add("HECUPhrases", HECUMenu)

function GM:GrabEarAnimation(ply)
	return false
end 